(function(a,x){function E(){this.settings={show_on:"mouseover"}}function p(a,b){this.id=t;this.type="spot";this.x=a;this.y=b;this.content="";this.html='<div class="hb-spot hb-spot-object" id="hb-spot-'+this.id+'"><div class="hb-tooltip-wrap"><div class="hb-tooltip"></div></div></div>';this.root=this.css="";this.height=this.width=30;this.tooltipWidth="auto";this.settings={visible:"visible",show_on:q.settings.show_on,popup_position:"left",content:"",tooltip_width:200,tooltip_auto_width:!0};t++}function g(a, b){this.id=t;this.type="rect";this.x=a;this.y=b;this.height=this.width=0;this.content="";this.popupPosition=0;this.html='<div class="hb-rect-spot hb-spot-object" id="hb-spot-'+this.id+'"><div class="hb-tooltip-wrap"><div class="hb-tooltip"></div></div></div>';this.root=this.css="";this.success=!0;this.settings={visible:"invisible",show_on:q.settings.show_on,popup_position:"left",content:"",tooltip_width:200,tooltip_auto_width:!0};t++}function M(){a(".hb-scale-handle, .hb-move-handle, .hb-spot, .hb-spot-object").off(".hb"); a(".hb-scale-handle").on("mouseover.hb",function(){F("scale")});a(".hb-scale-handle").on("mouseout.hb",function(){r.hide();v=!1});a(".hb-move-handle").on("mouseover.hb",function(){F("move")});a(".hb-move-handle").on("mouseout.hb",function(){r.hide();v=!1});a(".hb-spot").on("mouseover.hb",function(){F("move")});a(".hb-spot").on("mouseout.hb",function(){r.hide();v=!1});a(".hb-spot-object").on("mouseup.hb",function(){a(this).toggleClass("visible-tooltip");d[a(this).attr("id").replace("hb-spot-","")].select()})} function F(a){r.html(a);r.show();r.css({left:n+15,top:o+15});v=!0}function N(){r.css({left:n+15,top:o+15})}function O(){a("#visible-select").val(c.settings.visible);a("#show-select").val(q.settings.show_on);a("#position-select").val(c.settings.popup_position);a("#content").val(c.settings.content);c.settings.tooltip_auto_width?(a("#tooltip-auto-width").attr("checked","checked"),a("#tooltip-width").attr("disabled","disabled").val(c.settings.tooltip_width)):(a("#tooltip-auto-width").removeAttr("checked"), a("#tooltip-width").removeAttr("disabled").val(c.settings.tooltip_width))}function G(){a("#hb-settings-wrap").find("input, textarea, select").attr("disabled","disabled")}function P(){a("input, textarea, select").not("#tooltip-width").removeAttr("disabled");a("#tooltip-auto-width").attr("checked")&&a("#tooltip-width").attr("disabled","disabled")}function S(a){return a=""+('$("#hotspot-'+a+'").hotspot({ "show_on" : "'+q.settings.show_on+'" });')}function T(){var c=Math.round(100*Math.random()),b,e= d.length,f;b=""+('<div id="hotspot-'+c+'" class="hs-wrap hs-loading">\n')+('<img src="'+h.find("img").attr("src")+'">\n');for(f=0;f<e;f++)d[f]&&(b+='<div class="hs-spot-object" data-type="'+d[f].type+'" data-x="'+d[f].x+'" data-y="'+d[f].y+'" data-width="'+d[f].width+'" data-height="'+d[f].height+'" data-popup-position="'+d[f].settings.popup_position+'" data-visible="'+d[f].settings.visible+'" data-tooltip-width="'+d[f].settings.tooltip_width+'" data-tooltip-auto-width="'+d[f].settings.tooltip_auto_width+ '">\n',b+=d[f].settings.content+"\n",b+="</div>\n");b+="</div>\n";a("#hb-html-code").val(b);a("#hb-javascript-code").val(S(c));a("#hb-live-preview").html(b);a("#hb-live-preview").find(".hs-wrap").hotspot({show_on:q.settings.show_on})}var h=0,d=[],q,t=0,e=0,n=0,o=0,j=0,k=0,y=0,z=0,i=0,s=0,H=0,I=0,J=0,K=0,l=0,m=0,A=!1,B=!1,L=!1,v=!1,u=!1,C=!1,w=!1,D=!1,Q="",R="",r="",c=x;E.prototype.apply=function(){for(var a=d.length,b=0;b<a;b++)d[b].settings.show_on=this.settings.show_on,d[b].apply_settings()};E.prototype.set= function(a,b){var c=d.length;this.settings[a]=b;for(var e=0;e<c;e++)d[e].settings[a]=this.settings[a]};p.prototype.init=function(){h.append(this.html);this.root=a("#hb-spot-"+this.id);this.root.css({left:this.x,top:this.y,width:this.width,height:this.height,"margin-left":-this.width/2,"margin-top":-this.height/2});this.apply_settings()};p.prototype.start_moving=function(){i=this.x;s=this.y};p.prototype.move=function(){this.x=i+j+this.width/2>l?l-this.width/2:0>i+j-this.width/2?this.width/2:i+j;this.y= s+k+this.height/2>m?m-this.height/2:0>s+k-this.height/2?this.height/2:s+k;this.root.css({left:this.x,top:this.y})};p.prototype.select=function(){P();a(".hb-spot-object.selected").removeClass("selected");this.root.addClass("selected");c=this;O()};p.prototype.del=function(){this.deselect();G();this.root.remove();d[this.id]=null};p.prototype.deselect=function(){this.root.removeClass("selected");c=x};p.prototype.apply_settings=function(){this.root.removeClass("left").removeClass("top").removeClass("bottom").removeClass("right").removeClass("mouseover").removeClass("always").removeClass("click").removeClass("visible").removeClass("invisible"); this.root.addClass(this.settings.popup_position);this.root.addClass(this.settings.show_on);this.root.addClass(this.settings.visible);this.root.find(".hb-tooltip").html(this.settings.content);this.settings.tooltip_auto_width?this.root.find(".hb-tooltip-wrap").css({width:"auto"}):this.root.find(".hb-tooltip-wrap").css({width:this.settings.tooltip_width})};g.prototype.init=function(){h.append(this.html);this.root=a("#hb-spot-"+this.id);this.root.css({left:this.x,top:this.y});this.apply_settings()};g.prototype.draw= function(){this.width=16>j?16:j;this.height=16>k?16:k;this.width=this.width+this.x>l?l-this.x:this.width;this.height=this.height+this.y>m?m-this.y:this.height;this.root.css({width:this.width,height:this.height})};g.prototype.end_drawing=function(){this.root.append(Q);this.root.append(R);16>this.width&&16>this.height&&(this.success=!1)};g.prototype.release=function(){this.root.remove();t--};g.prototype.start_moving=function(){i=this.x;s=this.y};g.prototype.move=function(){this.x=i+j+this.width>l?l- this.width:0>i+j?0:i+j;this.y=s+k+this.height>m?m-this.height:0>s+k?0:s+k;this.root.css({left:this.x,top:this.y})};g.prototype.start_scaling=function(){H=this.width;I=this.height};g.prototype.scale=function(){this.width=16>H+j?16:H+j;this.height=16>I+k?16:I+k;this.width=this.width+this.x>l?l-this.x:this.width;this.height=this.height+this.y>m?m-this.y:this.height;this.root.css({width:this.width,height:this.height})};g.prototype.select=function(){P();a(".hb-spot-object.selected").removeClass("selected"); this.root.addClass("selected");c=this;O()};g.prototype.del=function(){this.deselect();G();this.root.remove();d[this.id]=null};g.prototype.deselect=function(){this.root.removeClass("selected");c=x};g.prototype.apply_settings=function(){this.root.removeClass("left").removeClass("top").removeClass("bottom").removeClass("right").removeClass("always").removeClass("mouseover").removeClass("click").removeClass("visible").removeClass("invisible");this.root.addClass(this.settings.popup_position);this.root.addClass(this.settings.show_on); this.root.addClass(this.settings.visible);this.root.find(".hb-tooltip").html(this.settings.content);this.settings.tooltip_auto_width?this.root.find(".hb-tooltip-wrap").css({width:"auto"}):this.root.find(".hb-tooltip-wrap").css({width:this.settings.tooltip_width})};a(document).ready(function(){q=new E;h=a("#hb-map-wrap");J=h.offset().left;K=h.offset().top;var i=new Image;i.src=h.find("img").attr("src");i.complete?(l=h.width(),m=h.height()):i.onload=function(){l=h.width();m=h.height()};Q='<div class="hb-scale-handle"></div>'; R='<div class="hb-move-handle"></div>';a("body").prepend('<div id="hb-help-tooltip"></div>');r=a("#hb-help-tooltip");a("#result").on("click",T);h.on("mousedown",function(b){if(a(b.target).hasClass("hb-scale-handle")){w=true;e=d[a(b.target).closest(".hb-spot-object").attr("id").replace("hb-spot-","")];return false}if(a(b.target).hasClass("hb-move-handle")){u=true;e=d[a(b.target).closest(".hb-spot-object").attr("id").replace("hb-spot-","")];return false}if(a(b.target).hasClass("hb-spot")){u=true;e= d[a(b.target).attr("id").replace("hb-spot-","")];return false}if(a(b.target).closest(".hb-spot-object").length==0&&!a(b.target).hasClass("hb-spot-object")){A=true;return false}});a(document).on("mousemove",function(a){n=a.pageX;o=a.pageY;j=n-y;k=o-z;v&&N();if(e!==x)if(w){y=n;z=o;w=false;D=true;e.start_scaling()}else if(D)e.scale();else if(u){y=n;z=o;u=false;C=true;e.start_moving()}else if(C)e.move();else if(A&&!B){y=n;z=o;e=new g(n-J,o-K);e.init();L=B=true}else L?e.draw():N()});a(document).on("mouseup", function(b){if(C||D||u||w)w=u=D=C=false;else{if(B){e.end_drawing();if(e.success){d.push(e);M()}else e.release();L=B=false}else if((a(b.target).attr("id")=="hb-map-wrap"||a(b.target).closest("#hb-map-wrap").length!=0)&&A){e=new p(n-J,o-K);d[t-1]=e;e.init();M()}A=false}});a("#visible-select").on("change",function(){if(c){c.settings.visible=a(this).val();c.apply_settings()}});a("#show-select").on("change",function(){q.set("show_on",a(this).val());q.apply()});a("#position-select").on("change",function(){if(c){c.settings.popup_position= a(this).val();c.apply_settings()}});a("#content").on("change",function(){if(c){c.settings.content=a(this).val();c.apply_settings()}});a("#delete").on("click",function(){c&&c.del()});a("#tooltip-auto-width").on("change",function(){if(a(this).attr("checked")){a("#tooltip-width").attr("disabled","disabled");c.settings.tooltip_auto_width=true}else{a("#tooltip-width").removeAttr("disabled");c.settings.tooltip_auto_width=false}c.settings.tooltip_width=parseInt(a("#tooltip-width").val().replace("px","")); c.apply_settings()});a("#tooltip-width").on("change",function(){c.settings.tooltip_width=parseInt(a("#tooltip-width").val().replace("px",""));c.apply_settings()});G()})})(jQuery);